<!DOCTYPE html><html class="default" lang="en"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>demolished-rail</title><meta name="description" content="Documentation for demolished-rail"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">demolished-rail</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>demolished-rail</h1></div><div class="tsd-panel tsd-typography"><a id="md:demolished-rail" class="tsd-anchor"></a><h1 class="tsd-anchor-link">demolished-rail<a href="#md:demolished-rail" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This repository contains a TypeScript animation framework called <strong>demolished-rail</strong>, designed for creating complex and dynamic animations with ease. The framework provides a structured approach to building animations using scenes, entities, and a sequence controller. It also includes features like BPM synchronization, beat and tick events, and audio analysis (FFT) to create interactive and audio-reactive visualizations.</p>
<a id="md:features" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Features<a href="#md:features" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li>
<p><strong>Scene-based animation:</strong> Organize animations into scenes with defined start times and durations.</p>
</li>
<li>
<p><strong>Entity management:</strong> Create and manage individual animatable entities within scenes.</p>
</li>
<li>
<p><strong>Canvas-based entities:</strong> Draw animations using the HTML5 Canvas API.</p>
</li>
<li>
<p><strong>Shader-based entities:</strong> Leverage WebGL shaders or WebGPU shaders for high-performance graphics.</p>
</li>
<li>
<p><strong>WebGL support:</strong> Create entities with WebGL shaders using <code>GLSLShaderEntity</code> and <code>GLSLShaderRenderer</code>.</p>
</li>
<li>
<p><strong>WGSL support:</strong> Create entities with WGSL shaders for modern, safe, and portable graphics.</p>
</li>
<li>
<p><strong>Multi-pass rendering:</strong> Supports 1-n shader programs/buffers for complex effects.</p>
</li>
<li>
<p><strong>Texture support:</strong> Use 1-n textures within each shader program.</p>
</li>
<li>
<p><strong>Custom uniforms:</strong> Pass custom data to your shaders for dynamic control.</p>
</li>
<li>
<p><strong>Entity timing:</strong> Control the lifetime of entities within a scene using <code>startTimeinMs</code> and <code>durationInMs</code> properties.</p>
</li>
<li>
<p><strong>Entity event listeners:</strong> Attach event listeners directly to entities to trigger actions on beats, ticks, or bars.</p>
</li>
<li>
<p><strong>Sequence control:</strong> Orchestrate the playback of scenes in a sequence.</p>
</li>
<li>
<p><strong>BPM synchronization:</strong> Synchronize animations with beats per minute (BPM).</p>
</li>
<li>
<p><strong>Beat and tick events:</strong> Trigger events on beats and ticks for precise timing control.</p>
</li>
<li>
<p><strong>Audio analysis (FFT):</strong> Analyze audio frequencies to create audio-reactive visualizations.</p>
</li>
<li>
<p><strong>Asset loading:</strong> Helper functions for loading images, audio, and managing a texture cache.</p>
</li>
<li>
<p><strong>Transitions:</strong> Define transition effects for entities to create smooth entrances and exits.</p>
</li>
<li>
<p><strong>Easy customization:</strong> Create custom transition functions to achieve a wide range of effects (e.g., fading, scaling, sliding).</p>
</li>
<li>
<p><strong>Helper functions:</strong> Use <code>createFadeInTransition</code> and <code>createFadeOutTransition</code> to easily add fade effects.</p>
</li>
<li>
<p><strong>Post-processing:</strong> Apply visual effects to the entire scene or individual entities.</p>
</li>
<li>
<p><strong>Sequence-level post-processing:</strong> Add post-processing effects to the <code>Sequence</code> to affect the final output.</p>
</li>
<li>
<p><strong>Entity-level post-processing:</strong> Add post-processing effects to individual entities for customized visual enhancements.</p>
</li>
<li>
<p><strong>Helper functions:</strong> Use built-in post-processing functions like <code>createBlurPostProcessor</code>, <code>createGrayscalePostProcessor</code>, and <code>createInvertPostProcessor</code>.</p>
</li>
<li>
<p><strong>Beat-synced effects:</strong> Create post-processing effects that respond to the beat, such as the <code>createBeatShakePostProcessor</code>.</p>
</li>
<li>
<p><strong>Scene Builder:</strong> Use the <code>SceneBuilder</code> class to easily create scenes with automatically calculated start times based on their durations.</p>
</li>
<li>
<p><strong>Entity Builder:</strong> Use the <code>EntityBuilder</code> class to easily arrange entities within a scene with precise timing control.</p>
</li>
<li>
<p><strong>Sequence Helper:</strong> Use the <code>SequenceHelper</code> class to calculate durations based on beats, bars, or ticks, given a specific BPM and time signature.</p>
</li>
<li>
<p><strong>Compressor:</strong> Compress your animation and JavaScript code into a single, self-contained PNG image using the integrated <code>Compressor</code> class.</p>
</li>
<li>
<p><strong>Conductor:</strong> Use the <code>Conductor</code> class to create a timeline of events that trigger actions on entities based on time, beats, bars, or custom conditions.</p>
</li>
<li>
<p><strong>Effects and Helpers for common tasks:</strong></p>
</li>
<li>
<p><strong>EntityRenderer:</strong> A helper class to render and test individual entities or combinations of entities without needing a full <code>Sequence</code>.</p>
</li>
</ul>
<a id="md:installation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Installation<a href="#md:installation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code> npm  install demolished-rail
</code></pre>
<a id="md:usage" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Usage<a href="#md:usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="md:create-a-sequence-with-scene-and-entities" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Create a Sequence with scene and entities<a href="#md:create-a-sequence-with-scene-and-entities" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>1. Create a Sequence</strong>:</p>
<p>Create an instance of the Sequence class, providing the target canvas, BPM, time signature, audio loader, and an optional array of scenes.
Initialize the sequence using the initialize() method. This will load the audio and prepare the sequence for playback.</p>
<p><strong>2. Create Scene objects:</strong></p>
<p>Create instances of the Scene class, defining the name, start time, and duration of each scene.
Add entities to each scene using the addEntity() or addEntities() methods.</p>
<p><strong>3. Add scenes to the Sequence:</strong></p>
<p>Use the addScene() or addScenes() methods of the Sequence to add your scenes to the animation sequence.</p>
<p><strong>4. Start the animation:</strong></p>
<p>Call the play() method on the Sequence instance to start the animation.</p>
<p><strong>Example code</strong></p>
<pre><code class="typescript"><span class="hl-0">     </span><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">Scene</span><span class="hl-0">, </span><span class="hl-2">Sequence</span><span class="hl-0">, </span><span class="hl-2">DefaultAudioLoader</span><span class="hl-0">, </span><span class="hl-2">Entity</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-3">&#39;demolished-rail&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">      </span><span class="hl-4">// ... import other classes and effects ...</span><br/><span class="hl-0">      </span><br/><span class="hl-0">    </span><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-6">canvas</span><span class="hl-0"> = </span><span class="hl-2">document</span><span class="hl-0">.</span><span class="hl-7">getElementById</span><span class="hl-0">(</span><span class="hl-3">&#39;myCanvas&#39;</span><span class="hl-0">) </span><span class="hl-1">as</span><span class="hl-0"> </span><span class="hl-8">HTMLCanvasElement</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-6">audioLoader</span><span class="hl-0"> = </span><span class="hl-5">new</span><span class="hl-0"> </span><span class="hl-7">DefaultAudioLoader</span><span class="hl-0">(</span><span class="hl-3">&#39;/path/to/your/audio.mp3&#39;</span><span class="hl-0">); </span><span class="hl-4">// Use DefaultAudioLoader</span><br/><span class="hl-0">    </span><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-6">sequence</span><span class="hl-0"> = </span><span class="hl-5">new</span><span class="hl-0"> </span><span class="hl-7">Sequence</span><span class="hl-0">(</span><span class="hl-2">canvas</span><span class="hl-0">, </span><span class="hl-9">120</span><span class="hl-0">, </span><span class="hl-9">4</span><span class="hl-0">, </span><span class="hl-9">4</span><span class="hl-0">, </span><span class="hl-2">audioLoader</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-2">sequence</span><span class="hl-0">.</span><span class="hl-7">initialize</span><span class="hl-0">();</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-6">scene1</span><span class="hl-0"> = </span><span class="hl-5">new</span><span class="hl-0"> </span><span class="hl-7">Scene</span><span class="hl-0">(</span><span class="hl-3">&quot;Scene 1&quot;</span><span class="hl-0">, </span><span class="hl-9">0</span><span class="hl-0">, </span><span class="hl-9">10000</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-4">// Example entity (replace with your actual entities)</span><br/><span class="hl-0">    </span><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-6">myEntity</span><span class="hl-0"> = </span><span class="hl-5">new</span><span class="hl-0"> </span><span class="hl-7">Entity</span><span class="hl-0">(</span><br/><span class="hl-0">      </span><span class="hl-3">&quot;MyEntity&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">      { </span><br/><span class="hl-0">        </span><span class="hl-4">// ... entity properties ...</span><br/><span class="hl-0">      },</span><br/><span class="hl-0">      (</span><span class="hl-2">ts</span><span class="hl-0">, </span><span class="hl-2">ctx</span><span class="hl-0">, </span><span class="hl-2">props</span><span class="hl-0">) </span><span class="hl-5">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">        </span><span class="hl-4">// ... entity action ...</span><br/><span class="hl-0">      }</span><br/><span class="hl-0">    );</span><br/><span class="hl-0">    </span><span class="hl-2">scene1</span><span class="hl-0">.</span><span class="hl-7">addEntity</span><span class="hl-0">(</span><span class="hl-2">myEntity</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-4">// ... create and add other scenes and entities ...</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-2">sequence</span><span class="hl-0">.</span><span class="hl-7">addScenes</span><span class="hl-0">(</span><span class="hl-2">scene1</span><span class="hl-0"> </span><span class="hl-4">/*, ... other scenes */</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-2">sequence</span><span class="hl-0">.</span><span class="hl-7">play</span><span class="hl-0">();</span><br/>
</code><button type="button">Copy</button></pre>

<a id="md:creating-a-canvas2d-entity-in-demolished-rail" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Creating a Canvas2D Entity in Demolished-rail<a href="#md:creating-a-canvas2d-entity-in-demolished-rail" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Demolished-rail provides a flexible way to create and animate entities using the HTML5 Canvas API. Here's how to set up a Canvas2D entity in your production:</p>
<p><strong>1. Define Entity Properties</strong></p>
<ul>
<li>Create an interface or type to define the properties of your entity. This will typically include properties for position, size, color, and any other attributes you want to control.</li>
</ul>
<p><strong>2. Create the Entity</strong></p>
<ul>
<li>Create a new <code>Entity</code> instance, passing the entity name, properties, and an action function.</li>
<li>The action function will be called on each frame, allowing you to draw and animate the entity using the Canvas 2D rendering context (<code>ctx</code>).</li>
</ul>
<p><strong>Example Code</strong></p>
<pre><code class="typescript"><span class="hl-0">	</span><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">Entity</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-3">&#39;demolished-rail&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-4">// Define entity properties</span><br/><span class="hl-0">    </span><span class="hl-5">interface</span><span class="hl-0"> </span><span class="hl-8">ICircleProps</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-2">x</span><span class="hl-0">: </span><span class="hl-8">number</span><span class="hl-0">;</span><br/><span class="hl-0">      </span><span class="hl-2">y</span><span class="hl-0">: </span><span class="hl-8">number</span><span class="hl-0">;</span><br/><span class="hl-0">      </span><span class="hl-2">radius</span><span class="hl-0">: </span><span class="hl-8">number</span><span class="hl-0">;</span><br/><span class="hl-0">      </span><span class="hl-2">color</span><span class="hl-0">: </span><span class="hl-8">string</span><span class="hl-0">;</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-4">// Create the entity</span><br/><span class="hl-0">    </span><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-6">circleEntity</span><span class="hl-0"> = </span><span class="hl-5">new</span><span class="hl-0"> </span><span class="hl-7">Entity</span><span class="hl-0">&lt;</span><span class="hl-8">ICircleProps</span><span class="hl-0">&gt;(</span><br/><span class="hl-0">      </span><span class="hl-3">&quot;MyCircle&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">      {</span><br/><span class="hl-0">        </span><span class="hl-2">x:</span><span class="hl-0"> </span><span class="hl-9">100</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-2">y:</span><span class="hl-0"> </span><span class="hl-9">100</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-2">radius:</span><span class="hl-0"> </span><span class="hl-9">50</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-2">color:</span><span class="hl-0"> </span><span class="hl-3">&#39;red&#39;</span><br/><span class="hl-0">      },</span><br/><span class="hl-0">      (</span><span class="hl-2">ts</span><span class="hl-0">, </span><span class="hl-2">ctx</span><span class="hl-0">, </span><span class="hl-2">props</span><span class="hl-0">) </span><span class="hl-5">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">        </span><span class="hl-4">// Draw a circle on the canvas</span><br/><span class="hl-0">        </span><span class="hl-2">ctx</span><span class="hl-0">.</span><span class="hl-7">beginPath</span><span class="hl-0">();</span><br/><span class="hl-0">        </span><span class="hl-2">ctx</span><span class="hl-0">.</span><span class="hl-7">arc</span><span class="hl-0">(</span><span class="hl-2">props</span><span class="hl-0">.</span><span class="hl-2">x</span><span class="hl-0">, </span><span class="hl-2">props</span><span class="hl-0">.</span><span class="hl-2">y</span><span class="hl-0">, </span><span class="hl-2">props</span><span class="hl-0">.</span><span class="hl-2">radius</span><span class="hl-0">, </span><span class="hl-9">0</span><span class="hl-0">, </span><span class="hl-9">2</span><span class="hl-0"> * </span><span class="hl-2">Math</span><span class="hl-0">.</span><span class="hl-6">PI</span><span class="hl-0">);</span><br/><span class="hl-0">        </span><span class="hl-2">ctx</span><span class="hl-0">.</span><span class="hl-2">fillStyle</span><span class="hl-0"> = </span><span class="hl-2">props</span><span class="hl-0">.</span><span class="hl-2">color</span><span class="hl-0">;</span><br/><span class="hl-0">        </span><span class="hl-2">ctx</span><span class="hl-0">.</span><span class="hl-7">fill</span><span class="hl-0">();</span><br/><span class="hl-0">      }</span><br/><span class="hl-0">    );</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-4">// Add the entity to a scene</span><br/><span class="hl-0">    </span><span class="hl-2">someScene</span><span class="hl-0">.</span><span class="hl-7">addEntity</span><span class="hl-0">(</span><span class="hl-2">circleEntity</span><span class="hl-0">);</span>
</code><button type="button">Copy</button></pre>

<a id="md:creating-a-webgl-shader-entity-in-demolished-rail" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Creating a WebGL Shader Entity in Demolished-Rail<a href="#md:creating-a-webgl-shader-entity-in-demolished-rail" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Demolished-rail also supports WebGL, allowing you to create shader entities using GLSL (OpenGL Shading Language). Here's how to set up a WebGL shader entity in your production:
<strong>1. Shader Properties</strong></p>
<ul>
<li>Define an object of type <code>IGLSLShaderProperties</code> to configure the shader entity. This object includes:
<ul>
<li><code>mainVertexShader</code>: The main vertex shader code (as a string).</li>
<li><code>mainFragmentShader</code>: The main fragment shader code (as a string).</li>
<li><code>renderBuffers</code>: An array of render buffer configurations, each with:
<ul>
<li><code>name</code>: The name of the buffer.</li>
<li><code>vertex</code>: The vertex shader code for the buffer.</li>
<li><code>fragment</code>: The fragment shader code for the buffer.</li>
<li><code>textures</code>: An array of texture names or URLs used by the buffer.</li>
<li><code>customUniforms</code>: An object defining any custom uniforms that need to be passed to the buffer's shaders.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>2. Create the Shader Entity</strong></p>
<ul>
<li>Create a new <code>GLSLShaderEntity</code> instance, passing the entity name, shader properties, an optional action function, and dimensions.</li>
<li>The action function will be called on each frame, allowing you to update uniforms or perform other actions.</li>
</ul>
<p><strong>Example Code</strong></p>
<pre><code class="typescript"><span class="hl-0">    </span><span class="hl-1">import</span><span class="hl-0"> { </span><br/><span class="hl-0">      </span><span class="hl-2">DefaultAudioLoader</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-2">Entity</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-2">GLSLShaderEntity</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-2">IEntity</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-2">Scene</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-2">Sequence</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-2">SequenceHelper</span><span class="hl-0">,</span><br/><span class="hl-0">    } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-3">&#39;demolished-rail&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">earthShader</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-3">&#39;../assets/shaders/earthShader&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">mainFragment</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-3">&#39;../assets/shaders/mainFragment&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">mainVertex</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-3">&#39;../assets/shaders/mainVertex&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-4">// ... (inside your demo setup) ...</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-6">cameraPositions</span><span class="hl-0"> = [</span><br/><span class="hl-0">      [</span><span class="hl-9">0.0</span><span class="hl-0">, </span><span class="hl-9">1.2</span><span class="hl-0">, </span><span class="hl-9">0.7</span><span class="hl-0">],</span><br/><span class="hl-0">      [</span><span class="hl-9">0.5</span><span class="hl-0">, </span><span class="hl-9">1.0</span><span class="hl-0">, </span><span class="hl-9">0.9</span><span class="hl-0">],</span><br/><span class="hl-0">      </span><span class="hl-4">// ... more camera positions</span><br/><span class="hl-0">    ];</span><br/><span class="hl-0">    </span><span class="hl-5">let</span><span class="hl-0"> </span><span class="hl-2">cameraPos</span><span class="hl-0"> = </span><span class="hl-2">cameraPositions</span><span class="hl-0">[</span><span class="hl-9">0</span><span class="hl-0">];</span><br/><span class="hl-0">    </span><span class="hl-5">let</span><span class="hl-0"> </span><span class="hl-2">amountOfLightning</span><span class="hl-0"> = </span><span class="hl-9">1500.0</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-6">shader</span><span class="hl-0"> = </span><span class="hl-5">new</span><span class="hl-0"> </span><span class="hl-7">GLSLShaderEntity</span><span class="hl-0">&lt;</span><span class="hl-8">IEarthShader</span><span class="hl-0">&gt;(</span><br/><span class="hl-0">      </span><span class="hl-3">&quot;earthShader&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">      {</span><br/><span class="hl-0">        </span><span class="hl-2">cameraPos:</span><span class="hl-0"> </span><span class="hl-2">cameraPositions</span><span class="hl-0">[</span><span class="hl-9">0</span><span class="hl-0">],</span><br/><span class="hl-0">        </span><span class="hl-2">amountOfLightning:</span><span class="hl-0"> </span><span class="hl-9">1500</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-2">mainFragmentShader:</span><span class="hl-0"> </span><span class="hl-2">mainFragment</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-2">mainVertexShader:</span><span class="hl-0"> </span><span class="hl-2">mainVertex</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-2">renderBuffers:</span><span class="hl-0"> [</span><br/><span class="hl-0">          {</span><br/><span class="hl-0">            </span><span class="hl-2">name:</span><span class="hl-0"> </span><span class="hl-3">&quot;a_buffer&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">            </span><span class="hl-2">fragment:</span><span class="hl-0"> </span><span class="hl-2">earthShader</span><span class="hl-0">,</span><br/><span class="hl-0">            </span><span class="hl-2">vertex:</span><span class="hl-0"> </span><span class="hl-2">mainVertex</span><span class="hl-0">,</span><br/><span class="hl-0">            </span><span class="hl-2">textures:</span><span class="hl-0"> [],</span><br/><span class="hl-0">            </span><span class="hl-2">customUniforms:</span><span class="hl-0"> {</span><br/><span class="hl-0">              </span><span class="hl-3">&quot;amountOfLightning&quot;</span><span class="hl-2">:</span><span class="hl-0"> (</span><span class="hl-2">uniformLocation</span><span class="hl-0">, </span><span class="hl-2">gl</span><span class="hl-0">, </span><span class="hl-2">program</span><span class="hl-0">, </span><span class="hl-2">time</span><span class="hl-0">, </span><span class="hl-2">entity</span><span class="hl-0">) </span><span class="hl-5">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">                </span><span class="hl-2">gl</span><span class="hl-0">.</span><span class="hl-7">uniform1f</span><span class="hl-0">(</span><span class="hl-2">uniformLocation</span><span class="hl-0">, </span><span class="hl-2">entity</span><span class="hl-0">.</span><span class="hl-2">props</span><span class="hl-0">!.</span><span class="hl-2">amountOfLightning</span><span class="hl-0">);</span><br/><span class="hl-0">              },</span><br/><span class="hl-0">              </span><span class="hl-3">&quot;cameraPos&quot;</span><span class="hl-2">:</span><span class="hl-0"> (</span><span class="hl-2">uniformLocation</span><span class="hl-0">, </span><span class="hl-2">gl</span><span class="hl-0">, </span><span class="hl-2">program</span><span class="hl-0">, </span><span class="hl-2">time</span><span class="hl-0">, </span><span class="hl-2">entity</span><span class="hl-0">) </span><span class="hl-5">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">                </span><span class="hl-2">gl</span><span class="hl-0">.</span><span class="hl-7">uniform3fv</span><span class="hl-0">(</span><span class="hl-2">uniformLocation</span><span class="hl-0">, </span><span class="hl-2">entity</span><span class="hl-0">.</span><span class="hl-2">props</span><span class="hl-0">!.</span><span class="hl-2">cameraPos</span><span class="hl-0">);</span><br/><span class="hl-0">              }</span><br/><span class="hl-0">            }</span><br/><span class="hl-0">          }</span><br/><span class="hl-0">        ]</span><br/><span class="hl-0">      },</span><br/><span class="hl-0">      (</span><span class="hl-2">ts</span><span class="hl-0">, </span><span class="hl-2">render</span><span class="hl-0">, </span><span class="hl-2">propertybag</span><span class="hl-0">) </span><span class="hl-5">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">        </span><span class="hl-4">// ... your additional logic for the shader entity ...</span><br/><span class="hl-0">      },</span><br/><span class="hl-0">      </span><span class="hl-9">800</span><span class="hl-0">, </span><span class="hl-4">// Canvas width</span><br/><span class="hl-0">      </span><span class="hl-9">450</span><span class="hl-0">  </span><span class="hl-4">// Canvas height</span><br/><span class="hl-0">    );</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-2">shader</span><span class="hl-0">.</span><span class="hl-7">onBar</span><span class="hl-0">&lt;</span><span class="hl-8">IEarthShader</span><span class="hl-0">&gt;((</span><span class="hl-2">ts</span><span class="hl-0">, </span><span class="hl-2">count</span><span class="hl-0">, </span><span class="hl-2">propertyBag</span><span class="hl-0">) </span><span class="hl-5">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-6">positionIndex</span><span class="hl-0"> = </span><span class="hl-2">count</span><span class="hl-0"> % </span><span class="hl-2">cameraPositions</span><span class="hl-0">.</span><span class="hl-2">length</span><span class="hl-0">;</span><br/><span class="hl-0">      </span><span class="hl-2">propertyBag</span><span class="hl-0">!.</span><span class="hl-2">cameraPos</span><span class="hl-0"> = </span><span class="hl-2">cameraPositions</span><span class="hl-0">[</span><span class="hl-2">positionIndex</span><span class="hl-0">];</span><br/><span class="hl-0">    });</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-2">shader</span><span class="hl-0">.</span><span class="hl-7">onTick</span><span class="hl-0">&lt;</span><span class="hl-8">IEarthShader</span><span class="hl-0">&gt;((</span><span class="hl-2">ts</span><span class="hl-0">, </span><span class="hl-2">count</span><span class="hl-0">, </span><span class="hl-2">propertyBag</span><span class="hl-0">) </span><span class="hl-5">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-4">// ... update amountOfLightning based on audio ...</span><br/><span class="hl-0">    });</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-4">// Add the entity to a scene</span><br/><span class="hl-0">    </span><span class="hl-2">someScene</span><span class="hl-0">.</span><span class="hl-7">addEntity</span><span class="hl-0">(</span><span class="hl-2">shader</span><span class="hl-0">);</span><br/>
</code><button type="button">Copy</button></pre>

<a id="md:building-a-webgpu-shader-entity-in-demolished-rail" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Building a WebGPU Shader Entity in Demolished-Rail<a href="#md:building-a-webgpu-shader-entity-in-demolished-rail" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Demolished-rail now includes support for WebGPU, allowing you to create high-performance shader entities using the WGSL (WebGPU Shading Language). Here's a breakdown of how to set up a WebGPU shader entity in your production:</p>
<p><strong>1. Initialization</strong></p>
<ul>
<li>Create a new canvas element for the shader entity.</li>
<li>Initialize the WebGPU context and device using the <code>initWebGPU()</code> function.</li>
<li>Load any required textures using the <code>WGSLTextureLoader</code>.</li>
</ul>
<p><strong>2. Shader Properties</strong></p>
<ul>
<li>Define an object of type <code>IWGSLShaderProperties</code> to configure the shader entity. This object includes:
<ul>
<li><code>canvas</code>: The canvas element.</li>
<li><code>device</code>: The WebGPU device.</li>
<li><code>context</code>: The WebGPU canvas context.</li>
<li><code>shader</code>: The main shader (usually the <code>defaultMainShader</code>).</li>
<li><code>renderBuffers</code>: An array of render buffer configurations, each with:
<ul>
<li><code>name</code>: The name of the buffer.</li>
<li><code>shader</code>: A <code>Material</code> object containing the WGSL vertex and fragment shader code.</li>
<li><code>geometry</code>: A <code>Geometry</code> object defining the geometry to be rendered.</li>
<li><code>textures</code>: An array of <code>IWgslTextureData</code> objects representing the textures to be used.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>3. Create the Shader Entity</strong></p>
<ul>
<li>Create a new <code>WGSLShaderEntity</code> instance, passing the entity name, shader properties, and an optional action function.</li>
<li>The action function will be called on each frame, allowing you to update uniforms or perform other actions.</li>
</ul>
<p><strong>Example Code</strong></p>
<pre><code class="typescript"><span class="hl-0">    </span><span class="hl-1">import</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-2">defaultMainShader</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-2">Geometry</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-2">IWGSLShaderProperties</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-2">Material</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-2">WGSLShaderEntity</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-2">WGSLTextureLoader</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-2">WGSLTextureType</span><span class="hl-0">,</span><br/><span class="hl-0">    } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-3">&#39;demolished-rail&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">rectGeometry</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-3">&#39;demolished-rail/Engine/ShaderRenderers/WebGPU/Geometry&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">initWebGPU</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-3">&#39;demolished-rail/Engine/ShaderRenderers/WebGPU/WGSLShaderRenderer&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">wgslFlamesShader</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-3">&#39;../assets/shaders/wglsl/wgslFlamesShader&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-4">// ... (inside your demo setup) ...</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-6">wgslCanvas</span><span class="hl-0"> = </span><span class="hl-2">document</span><span class="hl-0">.</span><span class="hl-7">createElement</span><span class="hl-0">(</span><span class="hl-3">&quot;canvas&quot;</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-2">wgslCanvas</span><span class="hl-0">.</span><span class="hl-2">width</span><span class="hl-0"> = </span><span class="hl-9">800</span><span class="hl-0">; </span><span class="hl-4">// Set your desired width</span><br/><span class="hl-0">    </span><span class="hl-2">wgslCanvas</span><span class="hl-0">.</span><span class="hl-2">height</span><span class="hl-0"> = </span><span class="hl-9">450</span><span class="hl-0">; </span><span class="hl-4">// Set your desired height</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-6">webgpu</span><span class="hl-0"> = </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-7">initWebGPU</span><span class="hl-0">(</span><span class="hl-2">wgslCanvas</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-6">wsglTextures</span><span class="hl-0"> = </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-2">WGSLTextureLoader</span><span class="hl-0">.</span><span class="hl-7">loadAll</span><span class="hl-0">(</span><span class="hl-2">webgpu</span><span class="hl-0">.</span><span class="hl-2">device</span><span class="hl-0">, {</span><br/><span class="hl-0">      </span><span class="hl-2">key:</span><span class="hl-0"> </span><span class="hl-3">&quot;NOISE-TEXTURE&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-2">source:</span><span class="hl-0"> </span><span class="hl-3">&quot;assets/images/noise.png&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-2">type:</span><span class="hl-0"> </span><span class="hl-2">WGSLTextureType</span><span class="hl-0">.</span><span class="hl-6">IMAGE</span><span class="hl-0">,</span><br/><span class="hl-0">    });</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-6">wgslShaderProps</span><span class="hl-0">: </span><span class="hl-8">IWGSLShaderProperties</span><span class="hl-0"> = {</span><br/><span class="hl-0">      </span><span class="hl-2">canvas:</span><span class="hl-0"> </span><span class="hl-2">wgslCanvas</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-2">device:</span><span class="hl-0"> </span><span class="hl-2">webgpu</span><span class="hl-0">.</span><span class="hl-2">device</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-2">context:</span><span class="hl-0"> </span><span class="hl-2">webgpu</span><span class="hl-0">.</span><span class="hl-2">context</span><span class="hl-0">!,</span><br/><span class="hl-0">      </span><span class="hl-2">shader:</span><span class="hl-0"> </span><span class="hl-2">defaultMainShader</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-2">renderBuffers:</span><span class="hl-0"> [</span><br/><span class="hl-0">        {</span><br/><span class="hl-0">          </span><span class="hl-2">name:</span><span class="hl-0"> </span><span class="hl-3">&quot;buffer-01&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">          </span><span class="hl-2">shader:</span><span class="hl-0"> </span><span class="hl-5">new</span><span class="hl-0"> </span><span class="hl-7">Material</span><span class="hl-0">(</span><span class="hl-2">webgpu</span><span class="hl-0">.</span><span class="hl-2">device</span><span class="hl-0">, </span><span class="hl-2">wgslFlamesShader</span><span class="hl-0">),</span><br/><span class="hl-0">          </span><span class="hl-2">geometry:</span><span class="hl-0"> </span><span class="hl-5">new</span><span class="hl-0"> </span><span class="hl-7">Geometry</span><span class="hl-0">(</span><span class="hl-2">webgpu</span><span class="hl-0">.</span><span class="hl-2">device</span><span class="hl-0">, </span><span class="hl-2">rectGeometry</span><span class="hl-0">),</span><br/><span class="hl-0">          </span><span class="hl-2">textures:</span><span class="hl-0"> </span><span class="hl-2">wsglTextures</span><br/><span class="hl-0">        }</span><br/><span class="hl-0">      ]</span><br/><span class="hl-0">    };</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-6">wgslShaderEntity</span><span class="hl-0"> = </span><span class="hl-5">new</span><span class="hl-0"> </span><span class="hl-7">WGSLShaderEntity</span><span class="hl-0">(</span><br/><span class="hl-0">      </span><span class="hl-3">&quot;wgsl-shader&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-2">wgslShaderProps</span><span class="hl-0">,</span><br/><span class="hl-0">      (</span><span class="hl-2">ts</span><span class="hl-0">: </span><span class="hl-8">number</span><span class="hl-0">, </span><span class="hl-2">wgslRenderer</span><span class="hl-0">: </span><span class="hl-8">WGSLShaderRenderer</span><span class="hl-0">, </span><span class="hl-2">props</span><span class="hl-0">: </span><span class="hl-8">IWGSLShaderProperties</span><span class="hl-0">) </span><span class="hl-5">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">        </span><span class="hl-4">// Perform operations, like modifying uniforms, per frame</span><br/><span class="hl-0">      }</span><br/><span class="hl-0">    );</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-4">// Add the entity to a scene</span><br/><span class="hl-0">    </span><span class="hl-2">someScene</span><span class="hl-0">.</span><span class="hl-7">addEntity</span><span class="hl-0">(</span><span class="hl-2">wgslShaderEntity</span><span class="hl-0">)</span><br/>
</code><button type="button">Copy</button></pre>

<a id="md:contributing" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Contributing<a href="#md:contributing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Contributions  are  welcome!  Feel  free  to  open  issues  or  submit  pull  requests.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:demolished-rail"><span>demolished-<wbr/>rail</span></a><ul><li><a href="#md:features"><span>Features</span></a></li><li><a href="#md:installation"><span>Installation</span></a></li><li><a href="#md:usage"><span>Usage</span></a></li><li><ul><li><a href="#md:create-a-sequence-with-scene-and-entities"><span>Create a <wbr/>Sequence with scene and entities</span></a></li><li><a href="#md:creating-a-canvas2d-entity-in-demolished-rail"><span>Creating a <wbr/>Canvas2<wbr/>D <wbr/>Entity in <wbr/>Demolished-<wbr/>rail</span></a></li><li><a href="#md:creating-a-webgl-shader-entity-in-demolished-rail"><span>Creating a <wbr/>WebGL <wbr/>Shader <wbr/>Entity in <wbr/>Demolished-<wbr/>Rail</span></a></li><li><a href="#md:building-a-webgpu-shader-entity-in-demolished-rail"><span>Building a <wbr/>WebGPU <wbr/>Shader <wbr/>Entity in <wbr/>Demolished-<wbr/>Rail</span></a></li></ul></li><li><a href="#md:contributing"><span>Contributing</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>demolished-rail</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
